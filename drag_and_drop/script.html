<script>
/************************************
グローバル変数
************************************/
var main_div = get_elem("main_div");
var box1 = get_elem("box1");
var box2 = get_elem("box2");
var ame = get_elem("ame");
var choco = get_elem("choco");
var gum = get_elem("gum");
var current_ta = get_elem("current_ta");
var start_ta = get_elem("start_ta");
var over_ta = get_elem("over_ta");
var drop_ta = get_elem("drop_ta");

//drag_overとdrag_dropの対象になる要素(子要素も)
//main_div.ondragover = drag_over;
//box1.ondragover = drag_over;
//box1.ondrop = drag_drop;
//box2.ondragover = drag_over;
//box2.ondrop = drag_drop;

//drag_startできる要素
//ame.ondragstart = drag_start;
//choco.ondragstart = drag_start;
/************************************
要素を取得する
************************************/
function get_elem(id){
  return document.getElementById(id);
}

/************************************
ドラッグ開始時の処理
var drag_elem_id;をグローバルにしたらdataTransfer不要？
************************************/
function drag_start(event){
  current_ta.value = event.currentTarget.outerHTML;
  start_ta.value = event.target.id + event.target.outerHTML;
  var drag_elem_id = event.target.id;
  event.dataTransfer.setData("text", drag_elem_id);//ドラッグするデータのid名をDataTransferオブジェクトにセット
}

/************************************
ドラッグ要素がドロップ要素に重なっている間の処理
************************************/
var over_elem;
function drag_over(event){
  current_ta.value = event.currentTarget.outerHTML;
  over_ta.value = event.target.id + event.target.outerHTML;
  over_elem = event.target.parentNode;//overしている要素はlabelなので親のdivまで取得
  event.preventDefault();
}

/************************************
ドロップ時の処理
************************************/
function drag_drop(event){
  current_ta.value = event.currentTarget.outerHTML;
  drop_ta.value = event.target.id + event.target.outerHTML;//ドラッグされたデータのid名をDataTransferオブジェクトから取得
  var drag_elem_id = event.dataTransfer.getData("text");//setData("text", drag_elem_id)でセットしたdrag_elem_idを"text"で取得
  var drag_elm = get_elem(drag_elem_id);//追加する要素をidで取得

  event.currentTarget.insertBefore(drag_elm, over_elem);//overしたdivの前に追加する
  //event.currentTarget.appendChild(drag_elm);
  event.preventDefault();
}

/************************************
  card.addEventListener('dragstart', drag_start, false);
  card.addEventListener('dragenter', drag_enter, false);
  card.addEventListener('dragover', drag_over, false);
  card.addEventListener('dragleave', drag_leave, false);
  card.addEventListener('drop', drag_drop, false);
  card.addEventListener('dragend', drag_end, false);
************************************/
var boxes = document.querySelectorAll('.box1, .box2');//document.querySelectorAllセレクタにマッチするエレメントをすべて取得する
console.log(boxes);
var boxes_array = [];
boxes_array.forEach.call(boxes, function(box) {
//  box.addEventListener('dragstart', drag_start, false);
//  box.addEventListener('dragenter', drag_enter, false);
  box.addEventListener('dragover', drag_over, false);
//  box.addEventListener('dragleave', drag_leave, false);
  box.addEventListener('drop', drag_drop, false);
//  box.addEventListener('dragend', drag_end, false);
});

var cards = document.querySelectorAll('.card');//document.querySelectorAllセレクタにマッチするエレメントをすべて取得する
console.log(cards);
var cards_array = [];
cards_array.forEach.call(cards, function(card) {
  card.addEventListener('dragstart', drag_start, false);
//  card.addEventListener('dragenter', drag_enter, false);
//  card.addEventListener('dragover', drag_over, false);
//  card.addEventListener('dragleave', drag_leave, false);
//  card.addEventListener('drop', drag_drop, false);
//  card.addEventListener('dragend', drag_end, false);
});
</script>